<?xml version="1.0"?>
<project name="Memeograph" default="build" basedir=".">

	<!--
	     	Define all of our properties here
	-->

	<!-- the port to make our connection across -->
	<property name="port" value="8000" />

	<!-- the type of transport that we are using -->
	<property name="transport" value="dt_socket" />

	<!-- Holds a list of all of the 'main' project's dependencies -->
	<path id="lib.path">
		<fileset dir=".">
			<include name="lib/*.jar" />
		</fileset>
	</path>

	<!--
	     	Define all of our run targets here
	-->

	<target name="run-test" depends="build">
		<java fork="true" classname="ReadChar" >
			<jvmarg value="-Xdebug" />
			<jvmarg value="-Xrunjdwp:transport=${transport},address=${port},server=y,suspend=n"/>
			<classpath>
				<path location="bin/test"/>
			</classpath>
		</java>
	</target>

	<target name="run-memeographer" depends="build">
	  	<java fork="true" classname="memeograph.Memeographer">
			<classpath>
				<path location="bin/main" />
				<path refid="lib.path" />
			</classpath>
		</java>
	</target>

        <target name="pdf" depends="build">
		<java fork="true" classname="memeograph.Memeographer">
		  	<arg value="dot" />
			<classpath>
				<path location="bin/main" />
				<path refid="lib.path" />
			</classpath>
		</java>
                <exec executable="dot">
                    <arg line="-Tpdf output.dot -o output.pdf"/>
                </exec>
        </target>

	<!--
	     	Define all of our build targets here
	-->

	<target name="build" depends="-compile-main,-compile-test" />

	<target name="-compile-main">
		<mkdir dir="bin/main" />
		<javac srcdir="src/main" destdir="bin/main" classpathref="lib.path" debug="on" source="6"/>
	</target>

	<target name="-compile-test">
		<mkdir dir="bin/test" />
		<javac debug="true" srcdir="src/test" destdir="bin/test" />
	</target>

	<!-- Basic simple clean target -->
	<target name="clean">
		<delete dir="bin"/>
	</target>

	<!-- Test parallel -->
	<target name="run" depends="build">
	  	<parallel>
		  	<!-- Start our target program -->
			<daemons>
			  <java fork="true" classname="ReadChar" >
			      <jvmarg value="-Xdebug" />
			      <jvmarg value="-Xrunjdwp:transport=${transport},address=${port},server=y,suspend=n"/>
			      <classpath>
				      <path location="bin/test"/>
			      </classpath>
			   </java>
			</daemons>

		  	<!-- Start our Memeographer -->
		  	<sequential>
			   <sleep seconds="3" />
			    <java fork="true" classname="memeograph.Memeographer">
				  <classpath>
					  <path location="bin/main" />
					  <path refid="lib.path" />
				  </classpath>
			    </java>
			</sequential>
		</parallel>
	</target>

</project>
